---
title: 'Laboratorio 1: Análisis Exploratorio CineVision'
output:
  html_document: default
  pdf_document: 
    latex_engine: lualatex
    fig_crop: false
date: "2026-02-02"
---

#### Integrantes:

-   22213 Jorge Chupina
-   241452 Yehosua Hércules
-   231270 Gadiel Ocaña

#### Repositorio de Github:

<https://github.com/yosemm/Laboratorio1>

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(nortest)
library(scales)
library(lubridate)
```

### Ejercicio 1: Exploración inicial

##### **Haga una exploración rápida de sus datos, para eso haga un resumen de su conjunto de datos.**

Se utiliza glimpse para esta exploración rápida, ya que nos permite ver la estructura general del dataset, el tipo de cada variable y una muestra de los datos. Además, se utiliza summary para obtener estadísticas descriptivas básicas de las variables cuantitativas y un resumen de las variables cualitativas.

```{r cargar_datos}
movies <- read.csv("movies_2026.csv", stringsAsFactors = FALSE)
```

```{r exploracion}
# Ver estructura general
glimpse(movies)

# Resumen
summary(movies)
```

A simple vista, se ve que se tratan de **19,883 filas** y **28 columnas**. En las fila de revenue y budget, el valor más bajo es de 0. Mientras que en las filas de *productionCompany*, *productionCompanyCountry* y *productionCountry*, hay valores vacíos. Lo cual puede indicar dificultades al momento de conseguir los datos.

### Ejercicio 2: Clasificación de Variables

##### **Diga el tipo de cada una de las variables (cualitativa ordinal o nominal, cuantitativa continua, cuantitativa discreta)**

Basado en la descripción de las variables y el contenido del dataset, la clasificación es la siguiente:

| Variable                      | Tipo de Variable      |
|:------------------------------|:----------------------|
| **id**                        | Cuantitativa Continua |
| **budget**                    | Cuantitativa Continua |
| **revenue**                   | Cuantitativa Continua |
| **runtime**                   | Cuantitativa Discreta |
| **voteAvg**                   | Cuantitativa Continua |
| **voteCount**                 | Cuantitativa Discreta |
| **genres**                    | Cualitativa Nominal   |
| **originalLanguage**          | Cualitativa Nominal   |
| **releaseYear**               | Cuantitativa Discreta |
| **video**                     | Cualitativa Nominal   |
| **homePage**                  | Cualitativa Nominal   |
| **productionCompany**         | Cualitativa Nominal   |
| **productionCompanyCountry**  | Cualitativa Nominal   |
| **productionCountry**         | Cualitativa Nominal   |
| **director**                  | Cualitativa Nominal   |
| **actors**                    | Cualitativa Nominal   |
| **actorsPopularity**          | Cuantitativa Continua |
| **actorsCharacter**           | Cualitativa Nominal   |
| **originalTitle**             | Cualitativa Nominal   |
| **title**                     | Cualitativa Nominal   |
| **popularity**                | Cuantitativa Continua |
| **releaseDate**               | Cualitativa Nominal   |
| **genresAmount**              | Cuantitativa Discreta |
| **productionCoAmount**        | Cuantitativa Discreta |
| **productionCountriesAmount** | Cuantitativa Discreta |
| **actorsAmount**              | Cuantitativa Discreta |
| **castWomenAmount**           | Cuantitativa Discreta |
| **castMenAmount**             | Cuantitativa Discreta |

**Nota:** En el dataset, los valores en *actorsPopularity* son de tipo carácter, pero representan una medida cuantitativa de popularidad.

La clasificación de las variables permite seleccionar adecuadamente las técnicas estadísticas y visualizaciones utilizadas en el análisis. No se identificaron variables cualitativas ordinales, ya que las variables categóricas presentes no poseen un orden natural. Las variables temporales, como la fecha y el año de lanzamiento, se consideran cuantitativas discretas debido a su naturaleza numérica y uso analítico.

### Ejercicio 3: Distribución de Variables

##### **Investigue si las variables cuantitativas siguen una distribución normal y haga una tabla de frecuencias de las variables cualitativas.**

```{r analisis_normalidad, fig.height=10, fig.width=8}
# Guardar las variables cuantitativas relevantes
vars_cuantitativas <- movies %>%
  select(budget, revenue, runtime, voteAvg, voteCount, genresAmount, productionCoAmount, productionCountriesAmount, actorsAmount, popularity, voteCount) %>%
  drop_na() # Eliminamos NAs

# 1. Visualización: Histogramas
vars_cuantitativas %>%
  pivot_longer(cols = everything(), names_to = "Variable", values_to = "Valor") %>%
  ggplot(aes(x = Valor)) +
  geom_histogram(bins = 30, fill = "cornflowerblue", color = "black") +
  facet_wrap(~Variable, scales = "free", ncol = 2) +
  theme_minimal() +
  labs(title = "Histogramas de Variables Cuantitativas", y = "Frecuencia")

# 2. Visualización: Boxplots (Diagramas de Caja)
vars_cuantitativas %>%
  pivot_longer(cols = everything(), names_to = "Variable", values_to = "Valor") %>%
  ggplot(aes(x = Variable, y = Valor)) +
  geom_boxplot(fill = "orange", alpha = 0.7) +
  facet_wrap(~Variable, scales = "free", ncol = 2) +
  theme_minimal() +
  labs(title = "Boxplots de Variables Cuantitativas", y = "Valor")

```

```{r pruebas_estadisticas, warning=FALSE}
# Función para aplicar tests
analizar_normalidad <- function(columna, nombre) {
  # Prueba de Kolmogorov-Smirnov
  ks <- ks.test(columna, "pnorm", mean(columna), sd(columna))
  
  # Prueba de Lilliefors
  lillie <- lillie.test(columna)
  
  return(data.frame(
    Variable = nombre,
    KS_p_value = ks$p.value,
    Lillie_p_value = lillie$p.value,
    Es_Normal = ifelse(lillie$p.value > 0.05, "Sí", "No")
  ))
}

# Aplicamos la función
resultados <- bind_rows(
  analizar_normalidad(movies$budget, "Budget"),
  analizar_normalidad(movies$revenue, "Revenue"),
  analizar_normalidad(movies$voteAvg, "VoteAvg"),
  analizar_normalidad(movies$popularity, "Popularity"),
  analizar_normalidad(movies$runtime[movies$runtime > 0], "Runtime"),
  analizar_normalidad(movies$voteCount, "VoteCount"),
  analizar_normalidad(movies$genresAmount, "GenresAmount"),
  analizar_normalidad(movies$productionCoAmount, "ProductionCoAmount"),
  analizar_normalidad(movies$productionCountriesAmount, "ProductionCountriesAmount"),
  analizar_normalidad(movies$actorsAmount, "ActorsAmount"),
  analizar_normalidad(movies$castWomenAmount[!is.na(movies$castWomenAmount)], "CastWomenAmount"),
  analizar_normalidad(movies$castMenAmount[!is.na(movies$castMenAmount)], "CastMenAmount")
)

print(resultados)
```

Los resultados de las pruebas de Kolmogorov-Smirnov y Lilliefors indican que ninguna de las variables cuantitativas analizadas sigue una distribución normal. Este resultado es consistente con los histogramas y boxplots presentados, donde se observan distribuciones asimétricas y presencia de valores extremos.

En particular, las variables financieras como presupuesto e ingresos presentan colas largas hacia la derecha, lo cual es característico de la industria cinematográfica, donde un número reducido de películas concentra una proporción significativa de los ingresos totales.

#### 3.3 Tablas de Frecuencia (Variables Cualitativas)

A continuación se muestran las frecuencias de variables categóricas.

```{r tablas_frecuencia}
# 1. Tabla de Frecuencias: Idioma Original (Top 10)
movies %>%
  count(originalLanguage, sort = TRUE) %>%
  head(10) %>% 
  mutate(Porcentaje = round(n / sum(movies %>% count(originalLanguage) %>% pull(n)) * 100, 2)) %>%
  knitr::kable(caption = "Top 10 Idiomas Originales más frecuentes")

# 2. Tabla de Frecuencias: Géneros
movies %>%
  # Separamos los géneros por la barra vertical "|"
  separate_rows(genres, sep = "\\|") %>%
  filter(genres != "") %>%
  count(genres, sort = TRUE) %>%
  mutate(Porcentaje = round(n / sum(n) * 100, 2)) %>%
  knitr::kable(caption="Frecuencia de Géneros (considerando cada género por separado)")

# 3. Tabla de Frecuencias: País de Producción (Top 10)
movies %>%
  # Eliminar los que están vacíos
  filter(productionCountry != "") %>%
  # Corregir "US" para que se combine con United States of America
  mutate(productionCountry = ifelse(productionCountry == "US", "United States of America", productionCountry)) %>% 
  count(productionCountry, sort = TRUE) %>%
  head(10) %>%
  mutate(Porcentaje = round(n / sum(n) * 100, 2)) %>%
  knitr::kable(caption = "Top 10 Países de Producción")

# 4. Tabla de Frecuencias: Compañía Productora (Top 10)
movies %>%
  filter(productionCompany != "") %>%
  count(productionCompany, sort = TRUE) %>%
  head(10) %>%
  mutate(Porcentaje = round(n / sum(movies %>% count(productionCompany) %>% pull(n)) * 100, 2)) %>%
  knitr::kable(caption = "Top 10 Compañías Productoras")

# 5. Tabla de Frecuencia simple: Video
movies %>%
  count(video) %>%
  mutate(Porcentaje = round(n / sum(n) * 100, 2)) %>%
  knitr::kable(caption = "Distribución de variable Video")
```
Las tablas de frecuencia muestran patrones claros en las variables cualitativas analizadas. El idioma inglés predomina ampliamente como idioma original, lo cual refleja su fuerte presencia en el mercado cinematográfico global.

En cuanto a los géneros, se observa que algunos géneros aparecen con mucha mayor frecuencia que otros, lo que sugiere una preferencia histórica por ciertos tipos de narrativas. Finalmente, la variable video indica que solo una parte de las películas cuenta con material promocional, evidenciando diferencias significativas en las estrategias de marketing empleadas.

### Ejercicio 4

##### **Responda las siguientes preguntas:**

**4.1 ¿Cuáles son las 10 películas que contaron con más presupuesto?**

```{r top_presupuesto}
options(scipen = 999)
top_budget <- movies %>%
  select(title, budget) %>%
  arrange(desc(budget)) %>%
  head(10)%>%
  mutate(budget = comma(budget))

knitr::kable(top_budget, caption = "Top 10 películas con mayor presupuesto")
```
Las películas con mayor presupuesto corresponden principalmente a producciones de gran escala, asociadas a grandes estudios y franquicias. Esto evidencia una alta concentración de recursos financieros en un número reducido de proyectos dentro de la industria cinematográfica.

**4.2 ¿Cuáles son las 10 películas que más ingresos tuvieron?**

```{r top_ingresos}
top_revenue <- movies %>%
  select(title, revenue) %>%
  arrange(desc(revenue)) %>%
  head(10) %>%
  mutate(revenue = comma(revenue))

knitr::kable(top_revenue, caption = "Top 10 películas con mayores ingresos")
```
Las películas con mayores ingresos tienden a coincidir con producciones de alto presupuesto, aunque no de forma estricta. Esto sugiere que una inversión elevada aumenta las probabilidades de éxito comercial, pero no garantiza altos ingresos por sí sola.

**4.3 ¿Cuál es la película que más votos tuvo?**

```{r top_votos}
top_votos <- movies %>%
  select(title, voteCount) %>%
  arrange(desc(voteCount)) %>%
  head(1)
knitr::kable(top_votos, caption = "Película con mayor número de votos de usuarios")
```
La película con mayor número de votos refleja una alta participación de los usuarios, lo cual suele estar asociado a una amplia distribución y una elevada visibilidad entre el público.

**4.4 ¿Cuál es la peor película de acuerdo a los votos de todos los usuarios?**

```{r peor_pelicula}
peor_pelicula <- movies %>%
  select(title, voteAvg, voteCount) %>%
  filter(voteCount > 100) %>%
  arrange(voteAvg) %>%
  head(1)
knitr::kable(peor_pelicula, caption = "Película con la peor calificación que obtuvo más de 100 votos")
```
El uso de un filtro mínimo de votos permite reducir el sesgo que generan películas con muy pocas evaluaciones. De esta forma, la calificación obtenida representa una opinión más confiable del público general y no casos aislados.

Agregamos un filtro para tomar las peliculas que sí recibieron varios votos.

**4.5 ¿Cuántas películas se hicieron en cada año? ¿En qué año se hicieron más películas? Haga un gráfico de barras**

```{r pelis_año}

peliculas_por_anio <- movies %>%
  filter(!is.na(releaseYear) & releaseYear > 0) %>%
  count(releaseYear) %>%
  rename(Anio = releaseYear, Cantidad = n)

anio_max <- peliculas_por_anio %>%
  arrange(desc(Cantidad)) %>%
  slice(1)

print(paste("El año en que se hicieron más películas fue:", anio_max$Anio, "con", anio_max$Cantidad, "películas."))

# Gráfico de Barras
ggplot(peliculas_por_anio, aes(x = Anio, y = Cantidad)) +
  geom_col(fill = "steelblue") +
  theme_minimal() +
  labs(
    title = "Cantidad de Películas producidas por Año",
    subtitle = paste("El pico máximo fue en", anio_max$Anio),
    x = "Año de Lanzamiento",
    y = "Cantidad de Películas"
  ) +
  scale_x_continuous(breaks = seq(min(peliculas_por_anio$Anio), max(peliculas_por_anio$Anio), by = 10))

```
El gráfico de barras evidencia una tendencia general al aumento en la cantidad de películas producidas por año. El año identificado como el de mayor producción refleja un pico en la actividad cinematográfica, lo cual puede asociarse al crecimiento de la industria y a la expansión de plataformas de distribución.

**4.6 ¿Cuál es el género principal de las 20 películas más recientes? ¿Cuál es el género principal que predomina en el conjunto de datos? Represéntelo usando un gráfico. ¿A qué género principal pertenecen las películas más largas?**

```{r analisis de generos, message=FALSE, warning=FALSE}

# Pre-procesamiento: 
movies_proc <- movies %>%
  mutate(
    genero_principal = str_extract(genres, "^[^|]+"),
    fecha_lanzamiento = as.Date(releaseDate)
  ) %>%
  filter(!is.na(genero_principal) & genero_principal != "")

top_recientes <- movies_proc %>%
  arrange(desc(fecha_lanzamiento)) %>%
  head(20) %>%
  count(genero_principal, sort = TRUE)

knitr::kable(top_recientes, caption = "4.6a: Géneros de las 20 películas más recientes")

# Género predominante
conteo_generos <- movies_proc %>%
  count(genero_principal, sort = TRUE) 
genero_top <- conteo_generos$genero_principal[1]
print(paste("El género que predomina en todo el dataset es:", genero_top))

# Gráfico Top 10 Géneros
ggplot(head(conteo_generos, 10), aes(x = reorder(genero_principal, n), y = n)) +
  geom_col(fill = "darkcyan") +
  coord_flip() +
  labs(title = "Top 10 Géneros Principales", x = "Género", y = "Cantidad") +
  theme_minimal()

# Género de las películas más largas
mas_largas <- movies_proc %>%
  arrange(desc(runtime)) %>%
  head(10) %>%
  select(title, runtime, genero_principal)

knitr::kable(mas_largas, caption = "4.6c: Género de las 10 películas más largas")
```
Para este análisis se definió el género principal como el primer género listado para cada película. Al analizar las 20 películas más recientes se observa una concentración en ciertos géneros, lo que sugiere tendencias actuales en la producción cinematográfica.

Al considerar el conjunto completo de datos, se identifica un género predominante que concentra la mayor cantidad de películas. Asimismo, las películas de mayor duración tienden a pertenecer a géneros asociados a narrativas más extensas o complejas.

**4.7. ¿Las películas de qué género obtuvieron mayores ganancias?**

```{r mayores_ganancias_genero}
ganancias_genero <- movies_proc %>%
  filter(revenue > 0) %>%
  group_by(genero_principal) %>%
  summarise(
    Peliculas = n(),
    Ingreso_Total = sum(revenue, na.rm = TRUE),
    Ingreso_Promedio = mean(revenue, na.rm = TRUE),
    .groups = "drop"
  ) %>%
  arrange(desc(Ingreso_Total))

top_ganancias_genero <- ganancias_genero %>%
  slice_head(n = 10)

knitr::kable(
  top_ganancias_genero %>%
    mutate(
      Ingreso_Total = dollar(Ingreso_Total, accuracy = 1),
      Ingreso_Promedio = dollar(Ingreso_Promedio, accuracy = 1)
    ),
  caption = "4.7: Top 10 géneros por ingreso total"
)

genero_mas_rentable <- ganancias_genero %>% slice(1)
print(
  paste(
    "El género con mayor ingreso total fue",
    genero_mas_rentable$genero_principal,
    "con",
    dollar(genero_mas_rentable$Ingreso_Total, accuracy = 1)
  )
)

ggplot(top_ganancias_genero, aes(x = reorder(genero_principal, Ingreso_Total), y = Ingreso_Total)) +
  geom_col(fill = "seagreen4") +
  coord_flip() +
  scale_y_continuous(labels = comma) +
  labs(
    title = "Top 10 Géneros por Ingreso Total",
    x = "Género principal",
    y = "Ingreso total"
  ) +
  theme_minimal()
```

Los géneros de acción y aventura concentran los mayores ingresos acumulados del conjunto.
Este comportamiento puede explicarse por el alto presupuesto, la amplia distribución internacional y el atractivo comercial de estos géneros, que suelen estar orientados a audiencias masivas.

**4.8. ¿La cantidad de actores influye en los ingresos de las películas? ¿Se han hecho películas con más actores en los últimos años?**

```{r actores_vs_ingresos}
datos_actores_ingresos <- movies %>%
  select(actorsAmount, revenue) %>%
  filter(!is.na(actorsAmount), !is.na(revenue), actorsAmount > 0, revenue > 0)

cor_actores_ingresos <- cor.test(
  datos_actores_ingresos$actorsAmount,
  log10(datos_actores_ingresos$revenue),
  method = "pearson"
)

print(
  paste(
    "Correlación (actores vs log10 ingresos):",
    round(cor_actores_ingresos$estimate, 3),
    "| p-value:",
    signif(cor_actores_ingresos$p.value, 3)
  )
)

ggplot(datos_actores_ingresos, aes(x = actorsAmount, y = log10(revenue))) +
  geom_point(alpha = 0.2, color = "steelblue") +
  geom_smooth(method = "lm", se = FALSE, color = "red") +
  labs(
    title = "Cantidad de actores vs Ingresos (escala log10)",
    x = "Cantidad de actores",
    y = "log10(Ingresos)"
  ) +
  theme_minimal()

actores_por_anio <- movies %>%
  select(releaseYear, actorsAmount) %>%
  filter(!is.na(releaseYear), releaseYear > 0, !is.na(actorsAmount), actorsAmount > 0) %>%
  group_by(releaseYear) %>%
  summarise(
    Promedio_Actores = mean(actorsAmount),
    Peliculas = n(),
    .groups = "drop"
  ) %>%
  arrange(releaseYear)

cor_anio_actores <- cor.test(
  actores_por_anio$releaseYear,
  actores_por_anio$Promedio_Actores,
  method = "pearson"
)

print(
  paste(
    "Correlación (año vs promedio de actores):",
    round(cor_anio_actores$estimate, 3),
    "| p-value:",
    signif(cor_anio_actores$p.value, 3)
  )
)

ggplot(actores_por_anio, aes(x = releaseYear, y = Promedio_Actores)) +
  geom_line(color = "darkorange") +
  geom_smooth(method = "lm", se = FALSE, color = "black", linetype = "dashed") +
  labs(
    title = "Promedio de actores por año",
    x = "Año",
    y = "Promedio de actores"
  ) +
  theme_minimal()
```

Se observa una relación positiva moderada entre cantidad de actores e ingresos, pero no una tendencia creciente sostenida del tamaño del elenco en los años más recientes.
En conjunto, los resultados indican que, aunque el tamaño del elenco puede influir en los ingresos, no existe una tendencia clara que indique un crecimiento sostenido del número de actores en las producciones más recientes.

**4.9. ¿Es posible que la cantidad de hombres y mujeres en el reparto influya en la popularidad y los ingresos de las películas?**

```{r reparto_genero_influencia}
datos_reparto <- movies %>%
  select(castWomenAmount, castMenAmount, popularity, revenue) %>%
  filter(
    !is.na(castWomenAmount), !is.na(castMenAmount),
    !is.na(popularity), !is.na(revenue)
  ) %>%
  mutate(
    Total_Reparto = castWomenAmount + castMenAmount,
    Proporcion_Mujeres = if_else(Total_Reparto > 0, castWomenAmount / Total_Reparto, NA_real_)
  ) %>%
  filter(!is.na(Proporcion_Mujeres), Total_Reparto > 0)

cor_mujeres_pop <- cor.test(datos_reparto$Proporcion_Mujeres, datos_reparto$popularity, method = "pearson")
cor_mujeres_rev <- cor.test(
  datos_reparto %>% filter(revenue > 0) %>% pull(Proporcion_Mujeres),
  log10(datos_reparto %>% filter(revenue > 0) %>% pull(revenue)),
  method = "pearson"
)

print(
  paste(
    "Correlación proporción de mujeres vs popularidad:",
    round(cor_mujeres_pop$estimate, 3)
  )
)
print(
  paste(
    "Correlación proporción de mujeres vs log10 ingresos:",
    round(cor_mujeres_rev$estimate, 3)
  )
)

resumen_reparto <- datos_reparto %>%
  mutate(
    Cuartil_Proporcion_Mujeres = ntile(Proporcion_Mujeres, 4),
    Cuartil_Proporcion_Mujeres = factor(
      Cuartil_Proporcion_Mujeres,
      levels = 1:4,
      labels = c("Q1 (menor proporción)", "Q2", "Q3", "Q4 (mayor proporción)")
    )
  ) %>%
  group_by(Cuartil_Proporcion_Mujeres) %>%
  summarise(
    Peliculas = n(),
    Popularidad_Promedio = mean(popularity, na.rm = TRUE),
    Ingreso_Promedio = mean(revenue, na.rm = TRUE),
    .groups = "drop"
  )

knitr::kable(
  resumen_reparto %>%
    mutate(Ingreso_Promedio = dollar(Ingreso_Promedio, accuracy = 1)),
  caption = "4.9: Resultados por cuartil de proporción de mujeres en el reparto"
)

datos_grafico_reparto <- bind_rows(
  datos_reparto %>%
    transmute(Proporcion_Mujeres, Metrica = "Popularidad", Valor = popularity),
  datos_reparto %>%
    filter(revenue > 0) %>%
    transmute(Proporcion_Mujeres, Metrica = "Ingresos (log10)", Valor = log10(revenue))
)

ggplot(datos_grafico_reparto, aes(x = Proporcion_Mujeres, y = Valor)) +
  geom_point(alpha = 0.2, color = "slateblue4") +
  geom_smooth(method = "lm", se = FALSE, color = "red") +
  facet_wrap(~Metrica, scales = "free_y") +
  labs(
    title = "Proporción de mujeres en reparto vs desempeño",
    x = "Proporción de mujeres en el reparto",
    y = "Valor"
  ) +
  theme_minimal()
```

En este conjunto, la composición hombres/mujeres del reparto muestra una relación muy débil con popularidad e ingresos.
Esto sugiere que la composición de género del elenco, por sí sola, no es un factor determinante en el desempeño comercial ni en la popularidad de las películas.

**4.10. ¿Quiénes son los directores que hicieron las 20 películas mejor calificadas?**

```{r directores_top_calificadas}
top_20_calificadas <- movies %>%
  select(title, director, voteAvg, voteCount) %>%
  mutate(
    title = iconv(title, to = "UTF-8"),
    director = iconv(director, to = "UTF-8"),
    director = str_trim(director) 
  ) %>%
  filter(
    !is.na(voteAvg),
    !is.na(voteCount),
    voteCount >= 100,
    !is.na(director),
    director != "",
    director != "NA"
  ) %>%
  arrange(desc(voteAvg), desc(voteCount)) %>%
  slice_head(n = 20)

knitr::kable(top_20_calificadas, caption = "4.10a: Top 20 películas mejor calificadas (mínimo 100 votos)")

directores_top <- top_20_calificadas %>%
  separate_rows(director, sep = "\\|") %>%
  mutate(director = str_trim(director)) %>%
  filter(director != "", director != "NA") %>%
  count(director, sort = TRUE)

knitr::kable(directores_top, caption = "4.10b: Directores presentes en el top 20")

ggplot(directores_top %>% slice_head(n = 10), aes(x = reorder(director, n), y = n)) +
  geom_col(fill = "cadetblue4") +
  coord_flip() +
  labs(
    title = "Directores con más apariciones en el top 20",
    x = "Director",
    y = "Cantidad de películas"
  ) +
  theme_minimal()
```

El top 20 concentra varios directores recurrentes, lo que sugiere consistencia de calidad en un grupo reducido.
La recurrencia de ciertos directores en el listado de películas mejor calificadas sugiere consistencia en la calidad percibida por el público, independientemente del volumen de producción.

**4.11. ¿Cómo se correlacionan los presupuestos con los ingresos? ¿Los altos presupuestos significan altos ingresos?**

```{r presupuesto_vs_ingresos, warning=FALSE}
datos_presupuesto_ingresos <- movies %>%
  select(budget, revenue) %>%
  filter(!is.na(budget), !is.na(revenue), budget > 0, revenue > 0)

cor_budget_revenue_pearson <- cor.test(
  log10(datos_presupuesto_ingresos$budget),
  log10(datos_presupuesto_ingresos$revenue),
  method = "pearson"
)

cor_budget_revenue_spearman <- cor.test(
  datos_presupuesto_ingresos$budget,
  datos_presupuesto_ingresos$revenue,
  method = "spearman"
)

print(
  paste(
    "Correlación Pearson (log-log):",
    round(cor_budget_revenue_pearson$estimate, 3),
    "| p-value:",
    signif(cor_budget_revenue_pearson$p.value, 3)
  )
)
print(
  paste(
    "Correlación Spearman:",
    round(cor_budget_revenue_spearman$estimate, 3),
    "| p-value:",
    signif(cor_budget_revenue_spearman$p.value, 3)
  )
)

datos_hist <- datos_presupuesto_ingresos %>%
  pivot_longer(cols = c(budget, revenue), names_to = "Variable", values_to = "Valor")

ggplot(datos_hist, aes(x = log10(Valor))) +
  geom_histogram(bins = 40, fill = "gray40", color = "white") +
  facet_wrap(~Variable, scales = "free_y") +
  labs(
    title = "Histogramas (escala log10)",
    x = "log10(valor)",
    y = "Frecuencia"
  ) +
  theme_minimal()

ggplot(datos_presupuesto_ingresos, aes(x = budget, y = revenue)) +
  geom_point(alpha = 0.2, color = "darkgreen") +
  geom_smooth(method = "lm", se = FALSE, color = "red") +
  scale_x_log10(labels = comma) +
  scale_y_log10(labels = comma) +
  labs(
    title = "Presupuesto vs Ingresos (escala log10)",
    x = "Presupuesto",
    y = "Ingresos"
  ) +
  theme_minimal()
```

Sí existe una correlación positiva alta: en general, películas con mayor presupuesto tienden a generar mayores ingresos.
No obstante, la dispersión observada en los gráficos indica que existen excepciones importantes, lo que confirma que un alto presupuesto no garantiza automáticamente el éxito comercial.

**4.12. ¿Se asocian ciertos meses de lanzamiento con mejores ingresos?**

```{r ingresos_por_mes}
meses_es <- c(
  "Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio",
  "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"
)

datos_mes_ingresos <- movies %>%
  mutate(
    fecha_lanzamiento = as.Date(releaseDate),
    mes_num = month(fecha_lanzamiento)
  ) %>%
  filter(!is.na(mes_num), !is.na(revenue), revenue > 0) %>%
  mutate(mes = factor(mes_num, levels = 1:12, labels = meses_es))

resumen_mes_ingresos <- datos_mes_ingresos %>%
  group_by(mes) %>%
  summarise(
    Peliculas = n(),
    Ingreso_Promedio = mean(revenue),
    Mediana_Ingreso = median(revenue),
    .groups = "drop"
  ) %>%
  arrange(desc(Ingreso_Promedio))

knitr::kable(
  resumen_mes_ingresos %>%
    mutate(
      Ingreso_Promedio = dollar(Ingreso_Promedio, accuracy = 1),
      Mediana_Ingreso = dollar(Mediana_Ingreso, accuracy = 1)
    ),
  caption = "4.12: Ingresos por mes de lanzamiento"
)

mes_top <- resumen_mes_ingresos %>% slice(1)
print(
  paste(
    "El mes con mejor ingreso promedio fue",
    mes_top$mes,
    "con",
    dollar(mes_top$Ingreso_Promedio, accuracy = 1)
  )
)

anova_meses <- aov(log10(revenue) ~ mes, data = datos_mes_ingresos)
print(summary(anova_meses))

ggplot(
  resumen_mes_ingresos %>% mutate(mes = fct_reorder(mes, Ingreso_Promedio)),
  aes(x = mes, y = Ingreso_Promedio)
) +
  geom_col(fill = "royalblue4") +
  coord_flip() +
  scale_y_continuous(labels = comma) +
  labs(
    title = "Ingreso promedio por mes de lanzamiento",
    x = "Mes",
    y = "Ingreso promedio"
  ) +
  theme_minimal()
```

Sí hay asociación por mes: algunos meses concentran ingresos promedio significativamente más altos.
Este patrón sugiere un efecto de estacionalidad en los lanzamientos cinematográficos, posiblemente relacionado con periodos vacacionales y festividades.

**4.13. ¿En qué meses se han visto los lanzamientos con mejores ingresos? ¿Cuántas películas, en promedio, se han lanzado por mes?**

```{r mejores_meses_lanzamientos}
datos_fechas <- movies %>%
  mutate(
    fecha_lanzamiento = as.Date(releaseDate),
    mes_num = month(fecha_lanzamiento)
  ) %>%
  filter(!is.na(mes_num)) %>%
  mutate(mes = factor(mes_num, levels = 1:12, labels = meses_es))

ingresos_por_mes <- datos_fechas %>%
  filter(!is.na(revenue), revenue > 0) %>%
  group_by(mes) %>%
  summarise(
    Ingreso_Total = sum(revenue),
    Ingreso_Promedio = mean(revenue),
    Peliculas_Con_Ingreso = n(),
    .groups = "drop"
  ) %>%
  arrange(desc(Ingreso_Total))

lanzamientos_por_mes <- datos_fechas %>%
  group_by(mes) %>%
  summarise(Peliculas_Lanzadas = n(), .groups = "drop")

promedio_lanzamientos <- mean(lanzamientos_por_mes$Peliculas_Lanzadas)
print(
  paste(
    "En promedio se lanzaron",
    round(promedio_lanzamientos, 2),
    "películas por mes en todo el periodo."
  )
)

knitr::kable(
  ingresos_por_mes %>%
    slice_head(n = 6) %>%
    mutate(
      Ingreso_Total = dollar(Ingreso_Total, accuracy = 1),
      Ingreso_Promedio = dollar(Ingreso_Promedio, accuracy = 1)
    ),
  caption = "4.13a: Meses con mayores ingresos totales"
)

knitr::kable(
  lanzamientos_por_mes,
  caption = "4.13b: Películas lanzadas por mes"
)

ggplot(lanzamientos_por_mes, aes(x = mes, y = Peliculas_Lanzadas)) +
  geom_col(fill = "darkgoldenrod3") +
  labs(
    title = "Cantidad de lanzamientos por mes",
    x = "Mes",
    y = "Películas lanzadas"
  ) +
  theme_minimal()
```

Los meses con mejor desempeño en ingresos no siempre son los de mayor cantidad de lanzamientos.
Esto indica que una mayor cantidad de estrenos no implica necesariamente un mayor ingreso total, lo que resalta la importancia del momento de lanzamiento y del contexto del mercado.

**4.14. ¿Cómo se correlacionan las calificaciones con el éxito comercial?**

```{r calificaciones_vs_exito}
datos_calificacion_exito <- movies %>%
  select(voteAvg, voteCount, revenue) %>%
  filter(!is.na(voteAvg), !is.na(voteCount), !is.na(revenue), voteCount >= 50, revenue > 0)

cor_calif_revenue_pearson <- cor.test(
  datos_calificacion_exito$voteAvg,
  log10(datos_calificacion_exito$revenue),
  method = "pearson"
)

cor_calif_revenue_spearman <- cor.test(
  datos_calificacion_exito$voteAvg,
  datos_calificacion_exito$revenue,
  method = "spearman"
)

print(
  paste(
    "Correlación Pearson (calificación vs log10 ingresos):",
    round(cor_calif_revenue_pearson$estimate, 3)
  )
)
print(
  paste(
    "Correlación Spearman (calificación vs ingresos):",
    round(cor_calif_revenue_spearman$estimate, 3)
  )
)

resumen_calif <- datos_calificacion_exito %>%
  mutate(
    Rango_Calificacion = cut(
      voteAvg,
      breaks = c(-Inf, 4, 6, 7, 8, Inf),
      labels = c("<=4", "4-6", "6-7", "7-8", ">8")
    )
  ) %>%
  group_by(Rango_Calificacion) %>%
  summarise(
    Peliculas = n(),
    Ingreso_Promedio = mean(revenue),
    .groups = "drop"
  )

knitr::kable(
  resumen_calif %>%
    mutate(Ingreso_Promedio = dollar(Ingreso_Promedio, accuracy = 1)),
  caption = "4.14: Ingreso promedio por rango de calificación"
)

ggplot(datos_calificacion_exito, aes(x = voteAvg, y = log10(revenue))) +
  geom_point(alpha = 0.2, color = "darkred") +
  geom_smooth(method = "lm", se = FALSE, color = "black") +
  labs(
    title = "Calificación promedio vs ingresos (log10)",
    x = "Calificación promedio (voteAvg)",
    y = "log10(Ingresos)"
  ) +
  theme_minimal()
```

La relación entre calificaciones y éxito comercial es positiva, pero de magnitud baja a moderada.
En consecuencia, la recepción positiva del público contribuye al desempeño financiero, pero no es suficiente por sí sola para garantizar altos ingresos.

**4.15. ¿Qué estrategias de marketing, como videos promocionales o páginas oficiales, generan mejores resultados?**

```{r estrategias_marketing}
datos_marketing <- movies %>%
  mutate(
    Tiene_Video = case_when(
      is.logical(video) ~ video,
      str_to_lower(as.character(video)) %in% c("true", "1", "si", "sí") ~ TRUE,
      TRUE ~ FALSE
    ),
    Tiene_HomePage = !is.na(homePage) & str_trim(homePage) != ""
  ) %>%
  select(Tiene_Video, Tiene_HomePage, revenue, popularity, voteAvg) %>%
  filter(!is.na(revenue), !is.na(popularity), !is.na(voteAvg)) %>%
  mutate(
    Estrategia = case_when(
      Tiene_Video & Tiene_HomePage ~ "Video + HomePage",
      Tiene_Video & !Tiene_HomePage ~ "Solo Video",
      !Tiene_Video & Tiene_HomePage ~ "Solo HomePage",
      TRUE ~ "Sin Video ni HomePage"
    )
  )

resumen_marketing <- datos_marketing %>%
  group_by(Estrategia) %>%
  summarise(
    Peliculas = n(),
    Ingreso_Promedio = mean(revenue),
    Popularidad_Promedio = mean(popularity),
    Calificacion_Promedio = mean(voteAvg),
    .groups = "drop"
  ) %>%
  arrange(desc(Ingreso_Promedio))

knitr::kable(
  resumen_marketing %>%
    mutate(Ingreso_Promedio = dollar(Ingreso_Promedio, accuracy = 1)),
  caption = "4.15: Desempeño por estrategia de marketing"
)

ggplot(resumen_marketing, aes(x = reorder(Estrategia, Ingreso_Promedio), y = Ingreso_Promedio)) +
  geom_col(fill = "forestgreen") +
  coord_flip() +
  scale_y_continuous(labels = comma) +
  labs(
    title = "Ingreso promedio según estrategia de marketing",
    x = "Estrategia",
    y = "Ingreso promedio"
  ) +
  theme_minimal()

ggplot(resumen_marketing, aes(x = reorder(Estrategia, Popularidad_Promedio), y = Popularidad_Promedio)) +
  geom_col(fill = "steelblue4") +
  coord_flip() +
  labs(
    title = "Popularidad promedio según estrategia de marketing",
    x = "Estrategia",
    y = "Popularidad promedio"
  ) +
  theme_minimal()
```

Tener página oficial se asocia con mejores resultados promedio; combinarla con video suele sostener mejor desempeño en popularidad e ingresos.
La combinación de múltiples estrategias de marketing parece reforzar el desempeño tanto en popularidad como en ingresos, en comparación con la ausencia de estas herramientas.

**4.16. ¿La popularidad del elenco está directamente correlacionada con el éxito de taquilla?**

```{r popularidad_elenco_taquilla, warning=FALSE}
promedio_pop_elenco <- function(x) {
  if (is.na(x) || x == "") {
    return(NA_real_)
  }
  valores <- suppressWarnings(as.numeric(str_split(x, "\\|")[[1]]))
  valores <- valores[!is.na(valores)]
  if (length(valores) == 0) {
    return(NA_real_)
  }
  mean(valores)
}

datos_pop_elenco <- movies %>%
  mutate(Popularidad_Elenco_Promedio = map_dbl(actorsPopularity, promedio_pop_elenco)) %>%
  select(Popularidad_Elenco_Promedio, revenue) %>%
  filter(
    !is.na(Popularidad_Elenco_Promedio), Popularidad_Elenco_Promedio > 0,
    !is.na(revenue), revenue > 0
  )

cor_pop_elenco_pearson <- cor.test(
  datos_pop_elenco$Popularidad_Elenco_Promedio,
  log10(datos_pop_elenco$revenue),
  method = "pearson"
)

cor_pop_elenco_spearman <- cor.test(
  datos_pop_elenco$Popularidad_Elenco_Promedio,
  datos_pop_elenco$revenue,
  method = "spearman"
)

print(
  paste(
    "Correlación Pearson (popularidad elenco vs log10 ingresos):",
    round(cor_pop_elenco_pearson$estimate, 3)
  )
)
print(
  paste(
    "Correlación Spearman (popularidad elenco vs ingresos):",
    round(cor_pop_elenco_spearman$estimate, 3)
  )
)

resumen_pop_elenco <- datos_pop_elenco %>%
  mutate(
    Cuartil_Pop_Elenco = ntile(Popularidad_Elenco_Promedio, 4),
    Cuartil_Pop_Elenco = factor(
      Cuartil_Pop_Elenco,
      levels = 1:4,
      labels = c("Q1 (menor)", "Q2", "Q3", "Q4 (mayor)")
    )
  ) %>%
  group_by(Cuartil_Pop_Elenco) %>%
  summarise(
    Peliculas = n(),
    Ingreso_Promedio = mean(revenue),
    .groups = "drop"
  )

knitr::kable(
  resumen_pop_elenco %>%
    mutate(Ingreso_Promedio = dollar(Ingreso_Promedio, accuracy = 1)),
  caption = "4.16: Ingreso promedio por cuartil de popularidad del elenco"
)

ggplot(datos_pop_elenco, aes(x = Popularidad_Elenco_Promedio, y = log10(revenue))) +
  geom_point(alpha = 0.2, color = "purple4") +
  geom_smooth(method = "lm", se = FALSE, color = "black") +
  labs(
    title = "Popularidad del elenco vs éxito de taquilla",
    x = "Popularidad promedio del elenco",
    y = "log10(Ingresos)"
  ) +
  theme_minimal()
```

La popularidad del elenco sí tiene relación positiva con taquilla, pero no es una relación fuerte por sí sola.
Esto sugiere que la popularidad del elenco actúa como un factor complementario al éxito comercial, pero no como un determinante principal.
